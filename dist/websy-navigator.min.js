"use strict";var _createClass=function(){function e(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var WebsyNavigator=function(){function g(t){_classCallCheck(this,g);var i={triggerClass:"trigger-item",triggerToggleClass:"trigger-toggle",viewClass:"view",activeClass:"active",viewAttribute:"data-view",groupAttribute:"data-group",parentAttribute:"data-parent",defaultView:"",defaultGroup:"main",subscribers:{show:[],hide:[]}};if(window.addEventListener("popstate",this.onPopState.bind(this)),this.options=Object.assign({},i,t),this.options.viewClass!==i.viewClass||this.options.activeClass!==i.activeClass){var s="\n        <style>\n          ."+this.options.viewClass+"{ display: none; }\n          ."+this.options.viewClass+"."+this.options.activeClass+"{ display: initial; }\n        </style>\n      ";document.querySelector("head").innerHTML+=s}this.groups={};for(var e=document.getElementsByClassName(this.options.triggerClass),a=0;a<e.length;a++){var o=e[a].attributes[this.options.viewAttribute];if(o&&""!==o.value){var n=e[a].attributes[this.options.groupAttribute],r=this.options.defaultGroup;n&&""!==n.value&&(r=n.value);var u=e[a].attributes[this.options.parentAttribute];u&&""!==u.value&&e[a].classList.add("parent-"+u.value),e[a].classList.add(this.options.triggerClass+"-"+r),e[a].addEventListener("click",this.navigate.bind(this,o.value,r))}}for(var l=document.getElementsByClassName(this.options.viewClass),h=0;h<l.length;h++){var v=l[h].attributes[this.options.groupAttribute],p=l[h].attributes[this.options.viewAttribute];v&&""!==v.value?(this.addGroup(v.value),l[h].classList.contains(this.options.activeClass)&&(this.groups[v.value].activeView=p.value),l[h].classList.add(this.options.viewClass+"-"+v.value)):l[h].classList.add(this.options.viewClass+"-"+this.options.defaultGroup);var c=l[h].attributes[this.options.parentAttribute];c&&""!==c.value&&(l[h].classList.add("parent-"+c.value),v&&""!==v.value&&this.groups[v.value]&&(this.groups[v.value].parent=c.value))}this.navigate(this.currentPath,this.options.defaultGroup)}return _createClass(g,[{key:"addGroup",value:function(t){this.groups[t]||(this.groups[t]={activeView:null})}},{key:"getActiveViewsFromParent",value:function(t){var i=[];for(var s in this.groups)this.groups[s].parent===t&&i.push(this.groups[s].activeView);return i}},{key:"init",value:function(){this.navigate(this.currentPath)}},{key:"hideView",value:function(t,i){if(this.hideTriggerItems(t,i),this.hideViewItems(t,i),i===this.options.defaultGroup){var s=document.getElementsByClassName("parent-"+t);if(s)for(var e=0;e<s.length;e++)if(s[e].classList.contains(this.options.viewClass)){var a=s[e].attributes[this.options.viewAttribute],o=s[e].attributes[this.options.groupAttribute];a&&""!==a.value&&this.hideView(a.value,o.value||this.options.defaultGroup)}}this.publish("hide",t)}},{key:"showView",value:function(t){this.activateItem(t,this.options.triggerClass),this.activateItem(t,this.options.viewClass);for(var i=this.getActiveViewsFromParent(t),s=0;s<i.length;s++)this.activateItem(i[s],this.options.triggerClass),this.activateItem(i[s],this.options.viewClass);this.publish("show",t)}},{key:"navigate",value:function(t,i,s){var e=!1,a=void 0;s&&(s.stopPropagation(),s.target.classList.contains(this.options.triggerToggleClass)&&(e=!0)),""==t&&(t=this.options.defaultView),this.groups[i]&&(a=this.groups[i].activeView),this.hideView(i),i&&this.groups[i]&&i!==this.options.defaultGroup&&(this.groups[i].activeView=t),!0===e&&null!=a&&t===a||(this.showView(t),this.currentPath!==t&&i===this.options.defaultGroup&&history.pushState({newPath:t},t,t))}},{key:"onPopState",value:function(t){this.navigate(t.state.path)}},{key:"publish",value:function(t,i){this.options.subscribers[t].forEach(function(t){t.call(null,i)})}},{key:"subscribe",value:function(t,i){this.options.subscribers[t].push(i)}},{key:"hideTriggerItems",value:function(t){var i=this.options.triggerClass;t&&(i+="-"+t),this.hideItems(i)}},{key:"hideViewItems",value:function(t){var i=this.options.viewClass;t&&(i+="-"+t),this.hideItems(i)}},{key:"hideItems",value:function(t){var i=document.getElementsByClassName(t);if(i)for(var s=0;s<i.length;s++)i[s].classList.remove(this.options.activeClass)}},{key:"activateItem",value:function(t,i){var s=document.getElementsByClassName(i);if(s)for(var e=0;e<s.length;e++)if(s[e].attributes[this.options.viewAttribute]&&s[e].attributes[this.options.viewAttribute].value===t){s[e].classList.add(this.options.activeClass);break}}},{key:"currentPath",get:function(){var t=window.location.pathname.split("/").pop();return-1!==t.indexOf(".htm")?"":t}}]),g}();